---
title: "Heat Maps Clustering Exercises"
date: "September 30, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

1. Load the data:
```{r}
library(GSE5859Subset)
data(GSE5859Subset)
```  

Pick the 25 genes with the highest across sample variance. This function might help
```{r}
#install.packages("matrixStats")
library(matrixStats)
?rowMads ##we use mads due to a outlier sample
```
While a heatmap function is included in R, we recommend the heatmap.2 function from the gplots package on CRAN because it is a bit more customized. For example, it stretches to fill the window.
```{r}
library(gplots)
```
Use heatmap.2 to make a heatmap showing the sampleInfo$group with color, the date as labels, the rows labelled with chromosome, and scaling the rows.
What do we learn from this heatmap?

    The data appears as if it was generated by rnorm
    Some genes in chr1 are very variable
    A group of chrY genes are higher in group 0 and appear to drive the clustering. Within those clusters there appears to be clustering by month.
    A group of chrY genes are higher in October compared to June and appear to drive the clustering. Within those clusters there appears to be clustering by samplInfo$group. 


```{r}
library(rafalib)
library(RColorBrewer)
rm <- rowMads(geneExpression)
idx <- order(rm,decreasing=TRUE)[1:25] # Pick the 25 genes with the highest across sample variance
hmcol <- colorRampPalette(brewer.pal(9,"GnBu"))(100)
cols <- colorRampPalette(brewer.pal(8,"Dark2"))(2)[as.factor(sampleInfo$group)] 

heatmap.2(geneExpression[idx,],
          labRow=geneAnnotation$CHR[idx],
          labCol=gsub("2005-","",sampleInfo$date),
          trace="none", 
          ColSideColors=cols,
          col=hmcol
         )
```
```{r}
# Model Answer
##load libraries
library(rafalib)
library(gplots)
library(matrixStats)
library(RColorBrewer)
##make colors
cols = colorRampPalette(rev(brewer.pal(11,"RdBu")))(25)
gcol=brewer.pal(3,"Dark2")
gcol=gcol[sampleInfo$g+1]

##make lables: remove 2005 since it's common to all
labcol= gsub("2005-","",sampleInfo$date)  

##pick highly variable genes:
sds =rowMads(geneExpression)
ind = order(sds,decreasing=TRUE)[1:25]

## make heatmap
heatmap.2(geneExpression[ind,],
          col=cols,
          trace="none",
          scale="row",
          labRow=geneAnnotation$CHR[ind],
          labCol=labcol,
          ColSideColors=gcol,
          key=FALSE)
```
2. Create a large data set of random data that is completely independent of sampleInfo$group like this:
```{r}
set.seed(17)
m = nrow(geneExpression)
n = ncol(geneExpression)
x = matrix(rnorm(m*n),m,n)
g = factor(sampleInfo$g )
  
```
Create two heatmaps with these data. Show the group g either with labels or colors.

    1. Taking the 50 genes with smallest p-values obtained with rowttests

    2. Taking the 50 genes with largest standard deviations.
    
Which of the following statements is true:

    These two techniques produced similar heatmaps.
    Selecting genes with the t-test is a better technique as it permits us to detect the two groups. It appears to find hidden signals.
    There is no relationship between g and x but with 8,793 tests some will appear significant by chance. Selecting genes with the t-test gives us a deceiving result. correct
    The genes with the largest standard deviation add variability to the plot and do not let us find the differences between the two groups. 


```{r}
source("http://bioconductor.org/biocLite.R")
biocLite()
biocLite("genefilter")
library(genefilter)
# Taking the 50 genes with smallest p-values obtained with rowttests and Taking the 50 genes with largest standard deviations
ttest = rowttests(x,g)
sds = rowSds(x)
idx = list(t=order(ttest$p.value)[1:50], s=order(-sds)[1:50])
# Make colors
cols = colorRampPalette(rev(brewer.pal(11,"RdBu")))(25)

for(i in idx){
 heatmap.2(x[i,],
          col=cols,
          trace="none",
          scale="row",
          labCol=g,
          key=FALSE)
}
```










